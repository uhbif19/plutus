<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">{- | The Float Delay optimization floats `Delay` from arguments into function bodies,
if possible. It turns @(\n -&gt; ...Force n...Force n...) (Delay arg)@ into
@(\n -&gt; ...Force (Delay n)...Force (Delay n)...) arg@.

The above transformation is performed if:

    * All occurrences of @arg@ are under @Force@.

    * @arg@ is essentially work-free.

This achieves a similar effect to Plutonomy's &quot;Split Delay&quot; optimization. The difference
is that Split Delay simply splits the @Delay@ argument into multiple arguments, turning the
above example into @(\m -&gt; (\n -&gt; ...Force n...Force n...) (Delay m)) arg@, and then relies
on other optimizations to simplify it further. Specifically, once the inliner inlines
@Delay m@, it will be identical to the result of Float Delay.

The advantages of Float Delay are:

    * It doesn't rely on the inliner. In this example, Split Delay relies on the inliner to
      inline @Delay m@, but there's no guarantee that the inliner will do so, because inlining
      it may increase the program size.

      We can potentially modify the inliner such that it is aware of Float Delay and
      Force-Delay Cancel, and makes inlining decisions with these other optimizations in mind.
      The problem is that, not only does this makes the inlining heuristics much more
      complex, but it could easily lead to code duplication. Other optimizations often
      need to do some calculation in order to make certain optimization decisions (e.g., in
      this case, we want to check whether all occurrences of @arg@ are under @Force@), and
      if we rely on the inliner to inline the @Delay@, then the same check would need to be
      performed by the inliner.

    * Because Force Delay requires that all occurrences of @arg@ are under @Force@, it
      guarantees to not increase the size or the cost of the program. This is not the case
      with Split Delay: in this example, if the occurrences of @n@ are not under @Force@,
      then Split Delay may increase the size of the program, regardless of whether or not
      @Delay m@ is inlined. If @Delay m@ is not inlined, then it will also increase the
      cost of the program, due to the additional application.

The alternative approach that always floats the @Delay@ regardless of whether or not all
occurences of @arg@ are under @Force@ was implemented and tested, and it is strictly worse than
Float Delay on our current test suite (specifically, Split Delay causes one test case
to have a slightly bigger program, and everything else is equal).

Why is this optimization performed on UPLC, not PIR?

    1. Not only are the types and let-bindings in PIR not useful for this optimization,
       they can also get in the way. For example, we cannot transform
       @let f = /\a. ...a... in ...{f t1}...{f t2}...@ into
       @ket f = ...a... in ...f...f...@.

    2. This optimization mainly interacts with ForceDelayCancel and the inliner, and
       both are part of the UPLC simplifier.
-}</span><span>
</span><span id="line-56"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">UntypedPlutusCore.Transform.FloatDelay</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.FloatDelay.html#floatDelay"><span class="hs-identifier">floatDelay</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.html"><span class="hs-identifier">PlutusCore</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.html"><span class="hs-identifier">UntypedPlutusCore.Core</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Writer.CPS</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span id="local-6989586621681144994"><span id="local-6989586621681144995"><span id="local-6989586621681144996"><span id="local-6989586621681144997"><span id="local-6989586621681144999"><span class="annot"><a href="UntypedPlutusCore.Transform.FloatDelay.html#floatDelay"><span class="hs-identifier hs-type">floatDelay</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">PLC.MonadQuote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144999"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Rename.html#Rename"><span class="hs-identifier hs-type">PLC.Rename</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144997"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144996"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144995"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144994"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144997"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144997"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144996"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144995"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144994"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><a href="#local-6989586621681144999"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144997"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144996"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144995"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144994"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-73"></span><span id="floatDelay"><span class="annot"><span class="annottext">floatDelay :: forall (m :: * -&gt; *) name (uni :: * -&gt; *) fun a.
(MonadQuote m, Rename (Term name uni fun a), Ord name) =&gt;
Term name uni fun a -&gt; m (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.FloatDelay.html#floatDelay"><span class="hs-identifier hs-var hs-var">floatDelay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *). (Rename a, MonadQuote m) =&gt; a -&gt; m a
</span><a href="PlutusCore.Rename.html#rename"><span class="hs-identifier hs-var">PLC.rename</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&gt;=&gt;</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681144854"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681144854"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall name a (uni :: * -&gt; *) fun.
Ord name =&gt;
Map name a -&gt; Term name uni fun a -&gt; Term name uni fun a
</span><a href="UntypedPlutusCore.Transform.FloatDelay.html#simplifyBodies"><span class="hs-identifier hs-var">simplifyBodies</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
Ord name =&gt;
Set name
-&gt; Term name uni fun a -&gt; (Term name uni fun a, Map name a)
</span><a href="UntypedPlutusCore.Transform.FloatDelay.html#simplifyArgs"><span class="hs-identifier hs-var">simplifyArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
Ord name =&gt;
Term name uni fun a -&gt; Set name
</span><a href="UntypedPlutusCore.Transform.FloatDelay.html#unforcedVars"><span class="hs-identifier hs-var">unforcedVars</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681144854"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681144854"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">{- | First pass. Returns the names of all variables, at least one occurrence
of which is not under `Force`.
-}</span><span>
</span><span id="line-80"></span><span class="annot"><a href="UntypedPlutusCore.Transform.FloatDelay.html#unforcedVars"><span class="hs-identifier hs-type">unforcedVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681144954"><span class="annot"><a href="#local-6989586621681144954"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681144953"><span class="annot"><a href="#local-6989586621681144953"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681144952"><span class="annot"><a href="#local-6989586621681144952"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681144951"><span class="annot"><a href="#local-6989586621681144951"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144954"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144954"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144953"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144952"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144951"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621681144954"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-81"></span><span id="unforcedVars"><span class="annot"><span class="annottext">unforcedVars :: forall name (uni :: * -&gt; *) fun a.
Ord name =&gt;
Term name uni fun a -&gt; Set name
</span><a href="UntypedPlutusCore.Transform.FloatDelay.html#unforcedVars"><span class="hs-identifier hs-var hs-var">unforcedVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall w a. Monoid w =&gt; Writer w a -&gt; w
</span><span class="hs-identifier hs-var">execWriter</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; Writer (Set name) ()
</span><a href="#local-6989586621681144830"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="#local-6989586621681144830"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144954"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144953"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144952"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144951"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Writer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621681144954"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>    </span><span id="local-6989586621681144830"><span class="annot"><span class="annottext">go :: Term name uni fun a -&gt; Writer (Set name) ()
</span><a href="#local-6989586621681144830"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-85"></span><span>      </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681144828"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681144828"><span class="hs-identifier hs-var">n</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall w (m :: * -&gt; *). (Monoid w, Monad m) =&gt; w -&gt; WriterT w m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681144828"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>      </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Force"><span class="hs-identifier hs-type">Force</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>      </span><span id="local-6989586621681144824"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681144824"><span class="hs-identifier hs-var">t</span></a></span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) r s a.
Functor f =&gt;
Getting (Traversed r f) s a -&gt; s -&gt; (a -&gt; f r) -&gt; f ()
</span><span class="hs-identifier hs-var">forOf_</span></span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun ann.
Traversal' (Term name uni fun ann) (Term name uni fun ann)
</span><a href="UntypedPlutusCore.Core.Plated.html#termSubterms"><span class="hs-identifier hs-var">termSubterms</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681144824"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; Writer (Set name) ()
</span><a href="#local-6989586621681144830"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">{- | Second pass. Removes `Delay` from eligible arguments, and returns
the names of variables whose corresponding arguments are modified.
-}</span><span>
</span><span id="line-92"></span><span class="annot"><a href="UntypedPlutusCore.Transform.FloatDelay.html#simplifyArgs"><span class="hs-identifier hs-type">simplifyArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681144959"><span class="annot"><a href="#local-6989586621681144959"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681144957"><span class="annot"><a href="#local-6989586621681144957"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681144956"><span class="annot"><a href="#local-6989586621681144956"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681144955"><span class="annot"><a href="#local-6989586621681144955"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144959"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-comment">-- | The set of variables returned by `unforcedVars`.</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621681144959"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144959"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144957"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144956"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144955"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144959"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144957"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144956"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144955"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621681144959"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144955"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span id="simplifyArgs"><span class="annot"><span class="annottext">simplifyArgs :: forall name (uni :: * -&gt; *) fun a.
Ord name =&gt;
Set name
-&gt; Term name uni fun a -&gt; (Term name uni fun a, Map name a)
</span><a href="UntypedPlutusCore.Transform.FloatDelay.html#simplifyArgs"><span class="hs-identifier hs-var hs-var">simplifyArgs</span></a></span></span><span> </span><span id="local-6989586621681144818"><span class="annot"><span class="annottext">Set name
</span><a href="#local-6989586621681144818"><span class="hs-identifier hs-var">blacklist</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall w a. Monoid w =&gt; Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ann.
Term name uni fun ann
-&gt; Writer (Map name ann) (Term name uni fun ann)
</span><a href="#local-6989586621681144816"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-101"></span><span>    </span><span id="local-6989586621681144910"><span class="annot"><a href="#local-6989586621681144816"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144959"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144957"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144956"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144910"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Writer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621681144959"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144910"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144959"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144957"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144956"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144910"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621681144816"><span class="annot"><span class="annottext">go :: forall ann.
Term name uni fun ann
-&gt; Writer (Map name ann) (Term name uni fun ann)
</span><a href="#local-6989586621681144816"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-103"></span><span>      </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621681144803"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681144803"><span class="hs-identifier hs-var">appAnn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span> </span><span id="local-6989586621681144801"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681144801"><span class="hs-identifier hs-var">lamAnn</span></a></span></span><span> </span><span id="local-6989586621681144800"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681144800"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681144799"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681144799"><span class="hs-identifier hs-var">lamBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Delay"><span class="hs-identifier hs-type">Delay</span></a></span><span> </span><span id="local-6989586621681144797"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681144797"><span class="hs-identifier hs-var">delayAnn</span></a></span></span><span> </span><span id="local-6989586621681144796"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681144796"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a. Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.FloatDelay.html#isEssentiallyWorkFree"><span class="hs-identifier hs-var">isEssentiallyWorkFree</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681144796"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-105"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681144800"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.notMember`</span></span><span> </span><span class="annot"><span class="annottext">Set name
</span><a href="#local-6989586621681144818"><span class="hs-identifier hs-var">blacklist</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>            </span><span class="annot"><span class="annottext">forall w (m :: * -&gt; *). (Monoid w, Monad m) =&gt; w -&gt; WriterT w m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681144800"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681144797"><span class="hs-identifier hs-var">delayAnn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>            </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun ann.
ann
-&gt; Term name uni fun ann
-&gt; Term name uni fun ann
-&gt; Term name uni fun ann
</span><a href="UntypedPlutusCore.Core.Type.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681144803"><span class="hs-identifier hs-var">appAnn</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun ann.
ann -&gt; name -&gt; Term name uni fun ann -&gt; Term name uni fun ann
</span><a href="UntypedPlutusCore.Core.Type.html#LamAbs"><span class="hs-identifier hs-var">LamAbs</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681144801"><span class="hs-identifier hs-var">lamAnn</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681144800"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall ann.
Term name uni fun ann
-&gt; Writer (Map name ann) (Term name uni fun ann)
</span><a href="#local-6989586621681144816"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681144799"><span class="hs-identifier hs-var">lamBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall ann.
Term name uni fun ann
-&gt; Writer (Map name ann) (Term name uni fun ann)
</span><a href="#local-6989586621681144816"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681144796"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-108"></span><span>      </span><span id="local-6989586621681144791"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681144791"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s t a b.
LensLike f s t a b -&gt; s -&gt; (a -&gt; f b) -&gt; f t
</span><span class="hs-identifier hs-var">forOf</span></span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun ann.
Traversal' (Term name uni fun ann) (Term name uni fun ann)
</span><a href="UntypedPlutusCore.Core.Plated.html#termSubterms"><span class="hs-identifier hs-var">termSubterms</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681144791"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall ann.
Term name uni fun ann
-&gt; Writer (Map name ann) (Term name uni fun ann)
</span><a href="#local-6989586621681144816"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- | Third pass. Turns @Force n@ into @Force (Delay n)@ for all eligibile @n@.</span><span>
</span><span id="line-111"></span><span id="local-6989586621681144963"><span id="local-6989586621681144964"><span id="local-6989586621681144965"><span id="local-6989586621681144966"><span class="annot"><a href="UntypedPlutusCore.Transform.FloatDelay.html#simplifyBodies"><span class="hs-identifier hs-type">simplifyBodies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144966"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621681144966"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144965"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144966"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144964"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144963"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144965"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144966"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144964"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144963"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144965"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-112"></span><span id="simplifyBodies"><span class="annot"><span class="annottext">simplifyBodies :: forall name a (uni :: * -&gt; *) fun.
Ord name =&gt;
Map name a -&gt; Term name uni fun a -&gt; Term name uni fun a
</span><a href="UntypedPlutusCore.Transform.FloatDelay.html#simplifyBodies"><span class="hs-identifier hs-var hs-var">simplifyBodies</span></a></span></span><span> </span><span id="local-6989586621681144785"><span class="annot"><span class="annottext">Map name a
</span><a href="#local-6989586621681144785"><span class="hs-identifier hs-var">whitelist</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. ASetter a b a b -&gt; (b -&gt; b) -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">transformOf</span></span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun ann.
Traversal' (Term name uni fun ann) (Term name uni fun ann)
</span><a href="UntypedPlutusCore.Core.Plated.html#termSubterms"><span class="hs-identifier hs-var">termSubterms</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-113"></span><span>  </span><span id="local-6989586621681144783"><span class="annot"><span class="annottext">var :: Term name uni fun a
</span><a href="#local-6989586621681144783"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681144782"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681144782"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681144781"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681144781"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681144782"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Map name a
</span><a href="#local-6989586621681144785"><span class="hs-identifier hs-var">whitelist</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun ann.
ann -&gt; Term name uni fun ann -&gt; Term name uni fun ann
</span><a href="UntypedPlutusCore.Core.Type.html#Delay"><span class="hs-identifier hs-var">Delay</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681144781"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681144783"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span id="local-6989586621681144779"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681144779"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681144779"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-comment">{- | Whether evaluating the given `Term` is pure and essentially work-free
(barring the CEK machine overhead).
-}</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-comment">--- This should be the erased version of 'PlutusIR.Transform.LetFloat.isEssentiallyWorkFree'.</span><span>
</span><span id="line-122"></span><span id="local-6989586621681144903"><span id="local-6989586621681144904"><span id="local-6989586621681144905"><span id="local-6989586621681144906"><span class="annot"><a href="UntypedPlutusCore.Transform.FloatDelay.html#isEssentiallyWorkFree"><span class="hs-identifier hs-type">isEssentiallyWorkFree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144906"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144905"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144904"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681144903"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span></span></span></span></span><span>
</span><span id="line-123"></span><span id="isEssentiallyWorkFree"><span class="annot"><span class="annottext">isEssentiallyWorkFree :: forall name (uni :: * -&gt; *) fun a. Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.FloatDelay.html#isEssentiallyWorkFree"><span class="hs-identifier hs-var hs-var">isEssentiallyWorkFree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Delay"><span class="hs-identifier hs-type">Delay</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Constr"><span class="hs-identifier hs-type">Constr</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Force"><span class="hs-identifier hs-type">Force</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-comment">-- Unsaturated builtin applications should also be essentially work-free,</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-comment">-- but this is currently not implemented for UPLC.</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-comment">-- `UntypedPlutusCore.Transform.Inline.isPure` has the same problem.</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-137"></span></pre></body></html>